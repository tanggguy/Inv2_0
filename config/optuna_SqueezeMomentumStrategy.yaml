# ============================================================================
# üî¨ CONFIGURATION D'OPTIMISATION OPTUNA
# ============================================================================
# 
# Ce fichier d√©finit la configuration compl√®te pour l'optimisation Optuna
# d'une strat√©gie de trading.
#
# Structure:
#   - strategy: D√©finition de la strat√©gie √† optimiser
#   - config: Configuration g√©n√©rale (symboles, p√©riode, capital)
#   - optuna: Param√®tres de l'optimiseur Optuna
#   - param_grid: Grille des param√®tres √† optimiser
#   - profiles: Profils pr√©d√©finis (quick/dev/prod)
#
# Usage:
#   python scripts/run_optuna_from_yaml.py optimization_configs/ma_strategy.yaml
#   python scripts/run_optuna_from_yaml.py optimization_configs/ma_strategy.yaml --profile prod
#
# ============================================================================

# ----------------------------------------------------------------------------
# üéØ STRAT√âGIE √Ä OPTIMISER
# ----------------------------------------------------------------------------
strategy:
  # Chemin Python complet vers la classe de strat√©gie
  # Format: module.sous_module.NomClasse
  class: "strategies.squeezemomentumstrategy.SqueezeMomentumStrategy"
  
  # Nom de la strat√©gie (pour les logs et rapports)
  name: "SqueezeMomentumStrategy"
  
  # Description optionnelle
  description: "Strat√©gie combinant MA, RSI avec trailing stop"

# ----------------------------------------------------------------------------
# ‚öôÔ∏è CONFIGURATION G√âN√âRALE
# ----------------------------------------------------------------------------
config:
  # Symboles √† trader (liste)
  symbols:
    - AAPL
    - MSFT
    - GOOGL
  
  # P√©riode de test
  period:
    start: "2017-01-01"
    end: "2024-01-01"
  
  # Capital initial en USD
  capital: 100000

# ----------------------------------------------------------------------------
# üî¨ PARAM√àTRES OPTUNA
# ----------------------------------------------------------------------------
optuna:
  # Nombre d'essais (trials)
  # Plus √©lev√© = meilleure exploration mais plus long
  # Recommand√©: 50-200 pour tests, 500-1000+ pour production
  n_trials: 200
  
  # Timeout en secondes (null = pas de limite)
  # Exemple: 3600 = 1 heure
  timeout: null
  
  # Algorithme de sampling
  # Options:
  #   - tpe: Tree-structured Parzen Estimator (recommand√©, intelligent)
  #   - random: √âchantillonnage al√©atoire
  #   - cmaes: Covariance Matrix Adaptation Evolution Strategy
  #   - grid: Grid search (exhaustif)
  sampler: "tpe"
  
  # Strat√©gie de pruning (arr√™t pr√©coce)
  # Options:
  #   - median: Arr√™te si en-dessous de la m√©diane
  #   - successive_halving: Tr√®s agressif
  #   - hyperband: √âquilibr√©
  #   - none: Pas de pruning
  pruner: "median"
  
  # Nombre de jobs parall√®les
  # -1 = utiliser tous les CPU disponibles
  # 1 = s√©quentiel
  # N = N processus en parall√®le
  n_jobs: 7
  
  # Sauvegarder les visualisations HTML
  save_plots: false
  
  # M√©trique √† optimiser (pour r√©f√©rence, g√©r√© automatiquement) : sharpe,return,drawdown
  optimize_metric: "sharpe"
  
  # Direction de l'optimisation
  direction: "maximize"

# ----------------------------------------------------------------------------
# ‚öôÔ∏è GRILLE DE PARAM√àTRES √Ä OPTIMISER
# ----------------------------------------------------------------------------
# 
# Format pour chaque param√®tre:
#
# 1. Liste de valeurs discr√®tes:
#    param_name: [val1, val2, val3, ...]
#
# 2. Range continu (pour Optuna):
#    param_name:
#      type: "int" ou "float"
#      low: valeur_min
#      high: valeur_max
#      step: pas (optionnel pour int)
#      log: true/false (√©chelle logarithmique, optionnel)
#
# 3. Cat√©gorique:
#    param_name: ["option1", "option2", "option3"]
#
# ----------------------------------------------------------------------------
param_grid:
  # P√©riode  
  bb_period:
    type: "int"
    low: 5
    high: 20
    step: 1
  # √âcart-type pour les bandes de Bollinger
  bb_std :
    type: "float"
    low: 1.5
    high: 2.5
    step: 0.2
  #
  keltner_period:
    type: "int"
    low: 15
    high: 25
    step: 2
  # 
  keltner_mult:
    type: "float"
    low: 1.5
    high: 2.5
    step: 0.2
  #
  atr_period:
    type: "int"
    low: 10
    high: 20
    step: 2
  #
  volume_period:
    type: "int"
    low: 10
    high: 30
    step: 2
  #
  adx_period:
    type: "int"
    low: 10
    high: 20
    step: 2

  # SQUEEZE
  min_squeeze_days:
    type: "int"
    low: 2
    high: 8
    step: 1
  # 
  squeeze_adx_max:
    type: "float"
    low: 16.0
    high: 40.0
    step: 2.0
  #
  squeeze_volume_factor:
    type: "float"
    low: 0.8
    high: 1.6
    step: 0.2
  #
  squeeze_atr_factor:
    type: "float"
    low: 0.8
    high: 1.6
    step: 0.2

  #BREAKOUT
  breakout_volume_mult:
    type: "float"
    low: 0.8
    high: 2.0
    step: 0.2
  #
  breakout_adx_min:
    type: "float"
    low: 10.0
    high: 30.0
    step: 5.0
  #
  min_candle_body_pct:
    type: "float"
    low: 0.2
    high: 0.6
    step: 0.1

# ----------------------------------------------------------------------------
# üéØ PROFILS PR√âD√âFINIS
# ----------------------------------------------------------------------------
# 
# Les profils permettent de d√©finir des configurations alternatives
# qui surchargent la configuration de base.
#
# Usage:
#   python scripts/run_optuna_from_yaml.py config.yaml --profile quick
#
# ----------------------------------------------------------------------------
profiles:
  # -------------------------------------------------------------------------
  # ‚ö° QUICK - Test rapide pour v√©rifier que tout fonctionne
  # -------------------------------------------------------------------------
  quick:
    description: "Test rapide - 1 symbole, p√©riode courte, peu de trials"
    
    config:
      symbols:
        - AAPL
      period:
        start: "2023-01-01"
        end: "2024-01-01"
      capital: 100000
    
    optuna:
      n_trials: 20
      timeout: 300  # 5 minutes max
      sampler: "random"
      pruner: "median"
      n_jobs: 4
      save_plots: false
    
    # Grille r√©duite pour tests rapides
    param_grid:
      ma_period: [20, 50]
      rsi_period: [14, 21]
      stop_loss_pct: [0.02, 0.03]
      trailing_stop_pct: [0.03]
      trailing_activation_pct: [0.02]
  
  # -------------------------------------------------------------------------
  # üîß DEV - D√©veloppement et mise au point
  # -------------------------------------------------------------------------
  dev:
    description: "D√©veloppement - √âquilibre entre vitesse et qualit√©"
    
    config:
      symbols:
        - AAPL
        - MSFT
      period:
        start: "2022-01-01"
        end: "2024-01-01"
      capital: 100000
    
    optuna:
      n_trials: 100
      timeout: 1800  # 30 minutes
      sampler: "tpe"
      pruner: "median"
      n_jobs: -1
      save_plots: true
    
    # Grille mod√©r√©e
    param_grid:
      ma_period:
        type: "int"
        low: 10
        high: 100
        step: 10
      rsi_period:
        type: "int"
        low: 10
        high: 25
        step: 5
      stop_loss_pct:
        type: "float"
        low: 0.015
        high: 0.04
        step: 0.005
      trailing_stop_pct:
        type: "float"
        low: 0.025
        high: 0.05
        step: 0.005
      trailing_activation_pct:
        type: "float"
        low: 0.01
        high: 0.03
        step: 0.005
  
  # -------------------------------------------------------------------------
  # üöÄ PROD - Production compl√®te avec exploration maximale
  # -------------------------------------------------------------------------
  prod:
    description: "Production - Exploration exhaustive, r√©sultats optimaux"
    
    config:
      symbols:
        - AAPL
        - MSFT
        - GOOGL
        - AMZN
        - META
      period:
        start: "2018-01-01"
        end: "2024-01-01"
      capital: 100000
    
    optuna:
      n_trials: 500
      timeout: null  # Pas de limite
      sampler: "tpe"
      pruner: "median"
      n_jobs: -1
      save_plots: true
    
    # Grille compl√®te (utilise celle d√©finie dans param_grid de base)
    # On peut aussi la surcharger ici si besoin

# ----------------------------------------------------------------------------
# üìù NOTES ET CONSEILS
# ----------------------------------------------------------------------------
#
# 1. CHOIX DU PROFIL:
#    - quick: V√©rification rapide (5-10 min)
#    - dev: D√©veloppement it√©ratif (30 min - 2h)
#    - prod: Optimisation finale (2h - 8h+)
#
# 2. NOMBRE DE TRIALS:
#    - Formule approximative: n_trials ‚âà 10 √ó nombre_de_param√®tres
#    - Pour 5 param√®tres: 50-100 trials minimum
#
# 3. SAMPLER:
#    - TPE: Le meilleur choix dans 95% des cas
#    - Random: Utile pour √©tablir une baseline
#
# 4. PRUNER:
#    - Median: Bon compromis vitesse/exploration
#    - None: Si vous avez du temps et voulez tout explorer
#
# 5. PARALL√âLISATION:
#    - n_jobs=-1: Utilise tous les CPU (recommand√©)
#    - Attention: Chaque job consomme de la RAM
#
# 6. VISUALISATION DES R√âSULTATS:
#    Apr√®s l'optimisation, lancez:
#    $ optuna-dashboard sqlite:///optimization/optuna_studies/optuna.db
#    
#    Puis ouvrez http://localhost:8080 dans votre navigateur
#
# 7. D√âFINITION DES RANGES:
#    - Commencez large, puis affinez
#    - Utilisez 'log: true' pour les param√®tres multiplicatifs
#    - step optionnel pour les entiers (sinon 1 par d√©faut)
#
# 8. GESTION M√âMOIRE:
#    Si vous manquez de RAM avec n_jobs=-1:
#    - R√©duisez n_jobs √† 4-8
#    - R√©duisez la p√©riode de test
#    - R√©duisez le nombre de symboles
#
# ============================================================================